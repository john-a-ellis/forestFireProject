<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Wildfire Causes and Effects in Canada</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>

<body>

  <div class="container">
    <div class="row">
      <div class="col-md-12 jumbotron text-center">
        <h1>Wildfire Causes and Effects in Canada</h1>
        <p>Use the interactive charts below to explore the dataset</p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4">
        <p>Pick the year:</p>
        <select id="yearDropdown" class="form-control">
          <option value="1960">1960</option>
          <option value="1970">1970</option>
          <option value="1980">1980</option>
          <option value="1990">1990</option>
          <option value="2000">2000</option>
          <option value="2010">2010</option>
          <option value="2020">2020</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div class="col-md-5">
        <h3>How has the frequency of wildfires changed over the years?</h3>
        <div id="bar"></div>
      </div>
      <div class="col-md-5">
        <div id="line"></div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <h3>What are the primary causes of wildfires?</h3>
        <div id="pie"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>
    // Render the Plotly charts
    function renderCharts() {
      // Sample data for the bar chart
      var barData = {
        x: [1960, 1970, 1980, 1990, 2000, 2010, 2020],
        y: [50, 100, 150, 170, 200, 180, 190],
        type: 'bar',
        marker: { color: 'blue' },
        opacity: 0.5
      };
      var barLayout = {
        title: 'Total Square Kilometers Burned per Year (1960-2021)',
        xaxis: { title: 'Year' },
        yaxis: { title: 'Square Kilometers Burned' }
      };
      Plotly.newPlot('bar', [barData], barLayout);

      // Sample data for the line chart
      var lineData = {
        x: [1960, 1970, 1980, 1990, 2000, 2010, 2020],
        y: [50, 60, 55, 70, 80, 75, 85],
        type: 'scatter',
        mode: 'lines+markers',
        yaxis: 'y2',
        marker: { color: 'red' }
      };
      var lineLayout = {
        yaxis2: {
          title: 'Count of Fires',
          overlaying: 'y',
          side: 'right',
          showgrid: false,
          showline: true,
          linecolor: 'red'
        },
        barmode: 'group'
      };
      Plotly.newPlot('line', [lineData], lineLayout);

      // Sample data for the pie chart
      var pieData = [{
        values: [25, 35, 20, 20],
        labels: ['Human (H)', 'Human with Power Line (H-PH)', 'Unknown (U)', 'Lightning (L)'],
        type: 'pie'
      }];
      var pieLayout = {
        title: 'Primary Causes of Wildfires',
        showlegend: true,
        legend: { x: 1.3, y: 0.9, traceorder: 'normal', font: { size: 8 } }
      };
      Plotly.newPlot('pie', pieData, pieLayout);

      // Add an event listener to the dropdown menu
      document.getElementById('yearDropdown').addEventListener('change', updateCharts);
    }

    function updateCharts() {
      var selectedYear = document.getElementById('yearDropdown').value;
      console.log('Selected Year:', selectedYear);
    
      // Fetch data from the server based on the selected year
      fetch('/data/' + selectedYear)
        .then(response => response.json())
        .then(data => {
          // Update the bar chart data
          var newBarData = {
            x: data.years,
            y: data.total_sq_km,
            type: 'bar',
            marker: { color: 'blue' },
            opacity: 0.5
          };
          Plotly.react('bar', [newBarData]);
    
          // Update the line chart data
          var newLineData = {
            x: data.years,
            y: data.count_of_fires,
            type: 'scatter',
            mode: 'lines+markers',
            yaxis: 'y2',
            marker: { color: 'red' }
          };
          Plotly.react('line', [newLineData]);
    
          // Update the pie chart data
          var newPieData = [{
            values: data.causes_values,
            labels: data.causes_labels,
            type: 'pie'
          }];
          Plotly.react('pie', newPieData);
        });
    }
    

    // Call the renderCharts function when the page is loaded
    document.addEventListener('DOMContentLoaded', renderCharts);

  </script>
</body>

</html>
